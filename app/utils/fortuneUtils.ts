/**
 * ğŸ“„ app/utils/fortuneUtils.ts
 * ì—­í• : ê³µí†µ ìœ í‹¸ í•¨ìˆ˜ ëª¨ìŒ
 * exports: calculateTwelveFortunes
 * imports: ../constants/elements, ./elementUtils
 * referenced by: app/calculators/sajuCalculator.ts
 */
// src/utils/fortuneUtils.ts
import { twelveJi } from "../constants/elements";
import { GanKey, JiKey } from "./elementUtils";

/**
 * ì‹­ì´ìš´ì„± ìˆœì„œ
 */
const twelveFortunesOrder = [
  "ì¥ìƒ", "ëª©ìš•", "ê´€ëŒ€", "ê±´ë¡", "ì œì™•",
  "ì‡ ", "ë³‘", "ì‚¬", "ë¬˜", "ì ˆ", "íƒœ", "ì–‘"
] as const;
type TwelveFortuneName = typeof twelveFortunesOrder[number];

const ganStartMap: Record<GanKey, { start: JiKey; forward: boolean }> = {
  "ê°‘": { start: "í•´", forward: true },
  "ì„": { start: "ì˜¤", forward: false },
  "ë³‘": { start: "ì¸", forward: true },
  "ì •": { start: "ì‹ ", forward: false },
  "ë¬´": { start: "ì¸", forward: true },
  "ê¸°": { start: "ì‹ ", forward: false },
  "ê²½": { start: "ì‚¬", forward: true },
  "ì‹ ": { start: "ì", forward: false },
  "ì„": { start: "ì‹ ", forward: true },
  "ê³„": { start: "ë¬˜", forward: false },
};

export const calculateTwelveFortunes = (
  daySky: GanKey,
  ground: JiKey
): TwelveFortuneName => {
  const { start, forward } = ganStartMap[daySky];
  const startIndex = twelveJi.indexOf(start);
  const targetIndex = twelveJi.indexOf(ground);
  if (startIndex === -1 || targetIndex === -1) return "ì¥ìƒ";

  const distance = forward
    ? (targetIndex - startIndex + 12) % 12
    : (startIndex - targetIndex + 12) % 12;

  return twelveFortunesOrder[distance];
};
